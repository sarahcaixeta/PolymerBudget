<link rel="import" href="bower_components/core-drawer-panel/core-drawer-panel.html">
<link rel="import" href="bower_components/core-header-panel/core-header-panel.html">
<link rel="import" href="bower_components/core-toolbar/core-toolbar.html">
<link rel="import" href="bower_components/core-item/core-item.html">
<link rel="import" href="bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="bower_components/paper-input/paper-input.html">
<link rel="import" href="bower_components/paper-date-picker/paper-date-picker-dialog.html">
<link rel="import" href="bower_components/paper-fab/paper-fab.html">
<link rel="import" href="bower_components/paper-shadow/paper-shadow.html">
<link rel="import" href="bower_components/paper-dialog/paper-action-dialog.html">
<link rel="import" href="expense-list.html">

<polymer-element name="app-a">
  <template>
   <link rel="stylesheet" href="styles.css">

    <core-drawer-panel id="drawerPanel" responsiveWidth="600px">

      <core-header-panel drawer>
        <core-toolbar>Menu</core-toolbar>
        <core-item>
          <paper-input label="Budget"
          value="{{budget}}"
          on-change="{{calculate}}"
          floatingLabel></paper-input>
        </core-item>
        <core-item>
          <paper-date-picker-dialog id="initialDate" value="{{from}}" infiniteScrolling="false"></paper-date-picker-dialog>
          <label>From</label>
          <paper-button on-click="{{openInitialDatePicker}}" >{{formatDate(from)}}</paper-button>
        </core-item>
        <core-item>
          <paper-date-picker-dialog id="finalDate" value="{{to}}" infiniteScrolling="false"></paper-date-picker-dialog>
          <label>To</label>
          <paper-button on-click="{{openFinalDatePicker}}" >{{formatDate(to)}}</paper-button>
        </core-item>
          <label id="dateValidation" class='hidden'>The initial date should be before final date.</label>
      </core-header-panel>

      <core-header-panel main>
        <core-toolbar>
          <paper-icon-button icon="menu" on-click="{{toggleDrawer}}"></paper-icon-button>
          <span flex>Budgets</span>
          <div>${{dailyBudget}} <spam class="smallFont">per day</spam></div>
        </core-toolbar>

        <div>
          <expense-list expenses={{expenses}}></expense-list>
        </div>

        <paper-action-dialog id="newExpenseDialog">
          <div>
            <label>Name</label>
            <paper-input label="Food, drinks" value="{{name}}"></paper-input>
          </div>
          <div>
            <label>Amount</label>
            <paper-input label="10.00" value="{{value}}"></paper-input>
          </div>
          <div>
            <paper-date-picker-dialog id="expenseDate" value="{{newExpenseDate}}" infiniteScrolling="false"></paper-date-picker-dialog>
            <label>Date</label>
            <paper-button on-click="{{openExpenseDatePicker}}" >{{formatDate(newExpenseDate)}}</paper-button>
          </div>
          <paper-button dismissive>Cancel</paper-button>
          <paper-button affirmative on-click="{{addExpense}}">Add</paper-button>
        </paper-action-dialog>
        <paper-fab icon="icons:add" on-click="{{newExpense}}"></paper-fab>
      </core-header-panel>

    </core-drawer-panel>

  </template>
  <script>
    Polymer('app-a', {
      dailyBudget: 0.0,
      from: new Date(),
      to: moment().add(7, 'days').toDate(),
      newExpenseDate: new Date(),
      expenses: [{name: "food", price: "40.5", timestamp: moment().format("MMM DD YYYY")}],
      toggleDrawer: function() {
        this.$.drawerPanel.togglePanel();
      },
      openInitialDatePicker: function() {
        this.$.initialDate.open();
      },
      openFinalDatePicker: function() {
        this.$.finalDate.open();
      },
      openExpenseDatePicker: function() {
        this.$.expenseDate.open();
      },
      newExpense: function() {
        this.$.newExpenseDialog.toggle();
      },
      formatDate: function(date) {
        return date.toDateString();
      },
      fromChanged: function() {
        this.$.dateValidation.className = classAccordingToValidation(this.from, this.to);
        this.calculate();
      },
      toChanged: function() {
       this.$.dateValidation.className = classAccordingToValidation(this.from, this.to);
       this.calculate();
      },
      calculate: function() {
        if (this.$.dateValidation.className == 'hidden'){
          this.dailyBudget = calculateDailyBudget(this.from, this.to, this.budget, this.expenses);
        }
      },
      addExpense: function() {
        this.expenses.unshift({
          name: this.name,
          price: Number(this.value).toFixed(2),
          timestamp: this.formatDate(this.newExpenseDate)
        });
        this.name = "";
        this.value = "";
        this.newExpenseDate = new Date();
        this.dailyBudget = calculateDailyBudget(this.from, this.to, this.budget, this.expenses);
      }

    });
  </script>
</polymer-element>
